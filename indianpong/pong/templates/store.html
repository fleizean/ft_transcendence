{% extends 'base.html' %}

{% block title %}{{ username }} Store{% endblock title %}

{% load static %}

{% block stylesheet %}<link rel="stylesheet" href="../../../static/css/store.css">{% endblock stylesheet %}

{% block app %}
  {% include "_nav.html" %}
  <div class="container-top">
    <div class="store-card">
      <div class="modal fade" id="setPropertyModal" tabindex="-1" aria-labelledby="setPropertyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="setPropertyModalLabel">Özelliği Ayarla</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Buraya özelliklerin ayarlanacağı form elemanlarını ekleyebilirsiniz -->
              <!-- Örneğin: -->
              <label for="propertyName">Özellik Adı:</label>
              <input type="text" id="propertyName" name="propertyName">
              <!-- Diğer gerekli alanlar buraya gelebilir -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
              <button type="button" class="btn btn-primary">Kaydet</button>
            </div>
          </div>
        </div>
      </div>
       <div class="top-store">
        <div class="store-left">
          <h3>{{username}} / Store</h3>
        </div>
        <div class="top-store-card">
          <div class="store-right">
           
                <i class="bi bi-piggy-bank-fill flip-horizontal"></i> 
                <span class="small-wallet-name">Wallet:</span>
                <span class="wallet-amount">{{profile.pong_wallet}}P₩</span>
               
            
          </div>
        </div>
      </div>
      
      <div class="store-info">
        <span class="tooltiptext">Oyun oynayarak <span style="font-weight: bold;">P₩</span> kazanabilirsin.</span>
      </div>
        <div class="store-list">

          
          {% for item in store_items %}
            {% if item.is_status %}
              <div class="product-card">
                
                <img src="{% static 'assets/stores/'|add:item.image_url %}" alt="" />
                <h2 class="card__title">{{ item.name }}</h2>
                <span class="card__description">{{item.description}}</span>
                <div class="card__shop">
                  <span class="card__shop__price">{{item.price}}P₩</span>
                  {% if item.is_bought %}
                  <button class="card__shop__action-set" onclick="openSetPropertyModal()">
                    <i class="bi bi-gear-fill" style="color:white; font-size: 1.1em;"></i>
                  </button>
                    <button class="card__shop__action" onclick="showToast('{{item.name}} öğesini şu an kullanıma aldın', 'text-bg-success', 'bi bi-check-circle-fill')" >
                      <i class="bi bi-backpack-fill" style="color:white; font-size: 1.1em;"></i>
                    </button>
                    <button class="card__shop__action-close" onclick="showToast('{{item.name}} öğesini zaten satın aldın', 'text-bg-danger', 'bi bi-info-square-fill')">
                      <i class="bi bi-bag-heart-fill" style="color:white; font-size: 1.1em;"></i>
                    </button>
                    
                  {% else %}
                      <button class="card__shop__action" 
                          {% if item.price < profile.pong_wallet %}
                              onclick="showToast('{{ item.name }} öğesini başarıyla satın aldın.', 'text-bg-success', 'bi bi-check-circle-fill')"
                          {% else %}
                              onclick="showToast('{{ item.name}} öğesini satın almak için yeterli P₩`ın yok', 'text-bg-danger', 'bi bi-info-square-fill')"
                          {% endif %}
                      >
                      <i class="bi bi-bag-heart-fill" style="color:white; font-size: 1.1em;"></i>
                    </button>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endfor %}


          
        </div>
    </div>
    <div class="toast-container position-fixed bottom-0 end-0 p-6" style="margin-right: 20px; margin-bottom: 20px">
      <div class="toast text-bg-danger" id="liveToast" role="alert">
          <div class="toast-body">
              <div class="d-flex gap-4">
                  <span class="i-class"><i class="bi bi-bug-fill"></i></span>
                  <div class="d-flex flex-grow-1 align-items-center">
                      <span class="fw-semibold">NULL</span>
                      <span class="toast-close" data-bs-dismiss="toast"><i class="bi bi-x-circle-fill"></i></span>
                  </div>
              </div>
          </div>
      </div>
    </div>
</div>
<script>
function showToast(content, status, iconClass) {
    const liveToast = document.getElementById('liveToast');
    var toastContent = document.querySelector('#liveToast .fw-semibold');
    var toastIcon = document.querySelector('.toast-body .i-class i');

    toastIcon.className = iconClass;
    liveToast.classList.remove('text-bg-danger'); 
    liveToast.className = 'toast'; 
    liveToast.classList.add(status);

    toastContent.textContent = content;
    const toast = new bootstrap.Toast(liveToast);
    toast.show();
    setTimeout(function() {
        toast.hide();
    }, 8000);
}

document.addEventListener('DOMContentLoaded', (event) => {
  const storeInfos = document.getElementsByClassName('store-info'); // .store-info'ya erişim
    const smallWalletNames = document.getElementsByClassName('small-wallet-name');

    for (let i = 0; i < smallWalletNames.length; i++) {
        smallWalletNames[i].addEventListener('mouseover', () => {
            storeInfos[i].style.visibility = 'visible';
        });

        smallWalletNames[i].addEventListener('mouseout', () => {
            storeInfos[i].style.visibility = 'hidden';
        });
    }});

    function openSetPropertyModal() {
      var myModal = new bootstrap.Modal(document.getElementById('setPropertyModal'));
      myModal.show();
      // modal-backdrop öğesini kaldır
      var modalBackdrop = document.querySelector('.modal-backdrop');
      if (modalBackdrop) {
        modalBackdrop.parentNode.removeChild(modalBackdrop);
      }
    }
    
</script>
{% endblock app %}